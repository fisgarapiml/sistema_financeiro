{% extends "base.html" %}

{% block conteudo %}
<div class="container mt-4" style="font-family: 'Poppins', sans-serif;">

  <!-- TOPO: T√≠tulo e Filtros -->
  <div class="d-flex justify-content-between align-items-start mb-4 flex-wrap gap-3">
    <h3 class="mb-0">üìã Contas a Pagar</h3>

    <form method="GET" class="d-flex gap-2 flex-wrap align-items-end">
      <div class="border border-primary border-2 rounded-3 px-3 py-2 shadow-sm" style="min-width: 160px;">
        <label class="form-label text-muted small mb-1">De</label>
        <input type="date" name="data_de" value="{{ data_de }}" class="form-control form-control-sm border-0">
      </div>
      <div class="border border-primary border-2 rounded-3 px-3 py-2 shadow-sm" style="min-width: 160px;">
        <label class="form-label text-muted small mb-1">At√©</label>
        <input type="date" name="data_ate" value="{{ data_ate }}" class="form-control form-control-sm border-0">
      </div>
      <button type="submit" class="btn btn-primary px-4 shadow-sm">Filtrar</button>
    </form>
  </div>

 <!-- LINHA √öNICA: TODOS OS 6 CARDS -->
<div class="row g-3 mb-4">
  {% set cards = [
    {'titulo': 'Previsto', 'valor': totais.previsto},
    {'titulo': 'Pago', 'valor': totais.pago},
    {'titulo': 'Saldo', 'valor': totais.saldo},
    {'titulo': 'Atraso', 'valor': totais.atraso, 'classe': 'text-danger'},
    {'titulo': 'Hoje', 'valor': totais.hoje, 'classe': (
        'text-danger' if totais.hoje|float < 0 else 'text-success' if totais.hoje|float > 0 else 'text-muted'
      )},
    {'titulo': 'Amanh√£', 'valor': totais.amanha}
  ] %}
  {% for c in cards %}
  <div class="col-md-2 col-sm-4 col-6">
    <div class="card border border-primary border-2 rounded-4 shadow-sm overflow-hidden"
         style="background-color: white; min-height: 100px; transition: all 0.2s ease-in-out;"
         onmouseover="this.style.transform='scale(1.02)'; this.style.boxShadow='0 4px 12px rgba(13,110,253,0.15)'"
         onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='0 2px 6px rgba(0,0,0,0.08)'">

      <!-- Faixa Azul com T√≠tulo Centralizado -->
      <div class="bg-primary text-white py-1 px-2 text-center"
           style="font-size: 0.8rem; font-weight: 500;">
        {{ c.titulo }}
      </div>

      <!-- Valor Centralizado -->
      <div class="card-body d-flex align-items-center justify-content-center fs-5"
           style="min-height: 60px;">
        {% if c.titulo == 'Amanh√£' %}
          {% if c.valor|float > 0 %}
            <span class="text-danger">R$ {{ "%.2f"|format(c.valor|float) }}</span>
          {% else %}
            <span class="text-success">‚úÖ</span>
          {% endif %}
        {% else %}
          <span class="{{ c.classe if c.classe is defined else (
            'text-danger' if c.valor|float < 0 else 'text-success' if c.valor|float > 0 else 'text-muted'
          ) }}">{{ c.valor }}</span>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>

  <!-- GR√ÅFICOS -->
  <div class="row g-3">
    <div class="col-md-6">
      <div class="card shadow-sm rounded-4 p-2">
        <div id="grafico_status"></div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card shadow-sm rounded-4 p-2">
        <div id="grafico_categoria"></div>
      </div>
    </div>
  </div>

  <div class="row mt-4">
    <div class="col">
      <div class="card shadow-sm rounded-4 p-2">
        <div id="grafico_dia"></div>
      </div>
    </div>
  </div>

  <!-- TABELA DE LAN√áAMENTOS -->
  <div class="table-responsive mt-5">
    <table class="table table-bordered table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Fornecedor</th>
          <th>Vencimento</th>
          <th>Valor</th>
          <th>Pago</th>
          <th>Pendente</th>
          <th>Status</th>
          <th>Categoria</th>
          <th>Tipo</th>
          <th>Centro de Custo</th>
          <th>A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        {% for l in dados %}
        <tr>
          <td>{{ l[0] }}</td>
          <td>{{ l[1] }}</td>
          <td>R$ {{ "%.2f"|format(l[2]|float) }}</td>
          <td>R$ {{ "%.2f"|format(l[3]|float) }}</td>
          <td>R$ {{ "%.2f"|format(l[4]|float) }}</td>
          <td><span class="badge bg-secondary">{{ l[5] }}</span></td>
          <td>{{ l[6] }}</td>
          <td>{{ l[7] }}</td>
          <td>{{ l[8] }}</td>
          <td>
            <a href="/editar/{{ l[9] }}" class="btn btn-sm btn-outline-primary">‚úèÔ∏è</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>

<!-- PLOTLY CDN + GR√ÅFICOS -->
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
  Plotly.newPlot('grafico_status', {{ graficos.status | safe }}, {title: 'Total por Status'}, {responsive: true});
  Plotly.newPlot('grafico_categoria', {{ graficos.categoria | safe }}, {title: 'Distribui√ß√£o por Categoria'}, {responsive: true});
  Plotly.newPlot('grafico_dia', {{ graficos.dia | safe }}, {title: 'Contas a Pagar por Dia'}, {responsive: true});
</script>
{% endblock %}
