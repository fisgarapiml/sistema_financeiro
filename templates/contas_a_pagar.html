<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Contas a Pagar</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background-color: #ffffff;
      color: #000000;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
    }
    body.tema-escuro {
      background-color: #1e1e1e !important;
      color: white !important;
    }
    body.tema-escuro .form-control,
    body.tema-escuro .form-select {
      background-color: #2b2b2b !important;
      color: white !important;
      border-color: #444 !important;
    }
    body.tema-escuro .card-body,
    body.tema-escuro .card {
      background-color: #1e1e1e !important;
      color: white !important;
    }
    body.tema-escuro .btn-light {
      background-color: #444 !important;
      color: white !important;
      border: none;
    }
    body.tema-escuro .text-dark {
      color: white !important;
    }
    body.tema-escuro .bg-white {
      background-color: #1e1e1e !important;
    }
    body.tema-escuro .topo-fixo {
      background-color: #222 !important;
    }
    .menu-lateral {
      width: 220px;
      background-color: #001aff;
      padding: 30px 20px;
      min-height: 100vh;
      color: white;
    }
    .menu-lateral h2 {
      font-size: 18px;
      margin-bottom: 30px;
    }
    .menu-lateral a {
      color: white;
      text-decoration: none;
      display: block;
      margin-bottom: 15px;
      font-weight: bold;
    }
    .conteudo {
      flex: 1;
    }
    .topo-fixo {
      position: sticky;
      top: 0;
      background-color: #007bff;
      padding: 10px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1000;
    }
    .topo-fixo h1 {
      margin: 0;
      font-size: 20px;
      color: white;
    }
  </style>
</head>
<body>

  <!-- üìå Menu lateral -->
  <div class="menu-lateral">
    <h2>Grupo Fisgar</h2>
    <a href="/">üè† Dashboard</a>
    <a href="/contas-a-pagar">üìÅ Contas a Pagar</a>
    <a href="/compras">üßæ Compras</a>
    <a href="/produtos">üì¶ Produtos</a>
  </div>

  <div class="conteudo">
    <!-- üìå Cabe√ßalho -->
    <div class="topo-fixo d-flex justify-content-between align-items-center">
      <div class="d-flex gap-3 align-items-center">
        {% if status != 'Todos' %}
        <a href="/contas-a-pagar" class="btn btn-light btn-sm">‚Üê Voltar</a>
        {% endif %}
        <h1 style="margin: 0; font-size: 20px;">Contas a Pagar</h1>
      </div>

      <!-- üì¶ BOT√ïES EM MASSA -->
      <div class="d-flex gap-2">
        <!-- ‚úèÔ∏è Editar -->
        <button type="button" class="btn btn-white btn-sm border px-3 py-1"
            onclick="abrirModalEditarMassa()">‚úèÔ∏è Editar em Massa</button>

        <!-- üí∏ Baixar -->
        <button type="button" class="btn btn-white btn-sm border px-3 py-1"
                title="Dar baixa nos selecionados"
                onclick="abrirModalBaixarMassa()">
          üí∏ Baixar em Massa
        </button>

        <!-- üóëÔ∏è Excluir -->
        <form method="POST" action="/excluir-massa" id="form-excluir-topo" onsubmit="return confirmarExclusao();">
          <input type="hidden" name="codigos" id="codigosExcluir">
          <button type="submit" class="btn btn-white btn-sm border px-3 py-1" title="Excluir selecionados">
            üóëÔ∏è Excluir em Massa
          </button>
        </form>

        <!-- üåô Tema -->
        <button class="btn btn-sm btn-light" onclick="alternarTema()" id="botao-tema" title="Alternar tema">
          üåô
        </button>
      </div>
    </div>

    <!-- üìÜ Filtros -->
    <form method="get" class="d-flex align-items-center gap-3 py-3 px-4">
      <label for="inicio" class="mb-0">De:</label>
      <input type="date" name="inicio" id="inicio" value="{{ data_inicio }}" class="form-control form-control-sm bg-white text-dark border-secondary" style="max-width: 150px;">
      <label for="fim" class="mb-0">At√©:</label>
      <input type="date" name="fim" id="fim" value="{{ data_fim }}" class="form-control form-control-sm bg-white text-dark border-secondary" style="max-width: 150px;">
      <label for="status" class="mb-0">Status:</label>
      <select name="status" id="status" class="form-select form-select-sm bg-white text-dark border-secondary" style="max-width: 180px;">
        <option value="Todos" {% if status =='Todos' %}selected{% endif %}>Todos</option>
        <option value="Pago" {% if status =='Pago' %}selected{% endif %}>Pago</option>
        <option value="Aberto" {% if status =='Aberto' %}selected{% endif %}>Aberto</option>
        <option value="Pendente" {% if status =='Pendente' %}selected{% endif %}>Pendente</option>
        <option value="Pago Parcialmente" {% if status =='PagoParcialmente' %}selected{% endif %}>Pago Parcialmente</option>
        <option value="atrasados" {% if status =='atrasados' %}selected{% endif %}>Atrasados</option>
        <option value="hoje" {% if status =='hoje' %}selected{% endif %}>Hoje</option>
      </select>

      <button type="submit" class="btn btn-primary btn-sm">Filtrar</button>
    </form>

    <!-- üìÑ Bot√£o PDF do Dia -->
    {% if status == 'hoje' %}
    <div class="px-4 pt-2 pb-3">
      <a href="/gerar-pdf-hoje" class="btn btn-outline-dark btn-sm">
        üìÑ Gerar PDF do Dia
      </a>
    </div>
    {% endif %}

    <!-- üìä Cards -->
<div class="row g-3 mx-4 mb-4">
  {% set cores = {'total': 'primary', 'pagos': 'success', 'pendentes': 'warning', 'hoje': 'info', 'atrasados': 'danger'} %}
  {% for chave, valor in totais.items() %}
    <div class="col-md-2 col-sm-4 col-6">
      {% if chave == 'atrasados' %}
        <a href="/contas-a-pagar?status={{ chave }}" style="text-decoration: none;">
      {% endif %}

      <div class="card border border-{{ cores[chave] }} border-2 rounded-4 shadow-sm overflow-hidden"
           style="background-color: #ffffff; min-height: 100px; transition: 0.2s ease-in-out; cursor: pointer;"
           onmouseover="this.style.transform='scale(1.02)'"
           onmouseout="this.style.transform='scale(1)'"
           {% if chave == 'hoje' %}onclick="abrirModalLancamentosHoje()"{% endif %}>
        <div class="bg-{{ cores[chave] }} text-white py-1 px-2 text-center" style="font-size: 0.8rem;">
          {{ chave | capitalize }}
        </div>
        <div class="card-body d-flex align-items-center justify-content-center fs-5 text-dark">
          {{ (valor * -1) | formatar }}
        </div>
      </div>

      {% if chave == 'atrasados' %}
        </a>
      {% endif %}
    </div>
  {% endfor %}
</div>

    <!-- üè∑Ô∏è Tipos de Lan√ßamento -->
    {% if tipos %}
    <div class="mx-4 mb-3">
      <label class="fw-bold">Tipos de lan√ßamentos encontrados:</label>
      <div class="d-flex flex-wrap gap-2 mt-2">
        {% for t in tipos %}
          <span class="badge rounded-pill bg-light border text-dark px-3 py-2">
            {{ t }}
          </span>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- üßæ Cabe√ßalho fixo -->
    <div class="mx-4 sticky-top bg-white py-2 border-bottom text-muted small" style="z-index: 10;">
      <div class="d-flex gap-3 ps-2 fw-bold text-uppercase">
        <div style="width: 30px;"></div>
        <div style="width: 180px;">[Fornecedor]</div>
        <div style="width: 160px;">[Categoria]</div>
        <div style="width: 200px;">[Plano de Contas]</div>
        <div style="width: 160px;">[Centro de Custo]</div>
        <div style="width: 120px;">Vencimento</div>
        <div style="width: 120px;">Previsto</div>
        <div style="width: 120px;">Pago</div>
        <div style="width: 100px;">Status</div>
        <div style="width: 110px;">A√ß√µes</div>
      </div>
    </div>

    <!-- üßæ Listagem de lan√ßamentos -->
    <form method="POST" action="/excluir-massa" id="form-excluir" onsubmit="return confirmarExclusao();">
      {% for item in lancamentos %}
      <div class="border border-primary rounded-4 d-flex align-items-center px-3 py-2 mb-2 mx-4 bg-white text-dark small">
        <div class="d-flex align-items-center gap-3 w-100">

          <div style="width: 30px;">
            <input type="checkbox" name="codigos" value="{{ item.codigo }}">
          </div>

          <div style="width: 180px;"><span style="color: #007bff;">[</span>{{ item.fornecedor }}<span style="color: #007bff;">]</span></div>
          <div style="width: 160px;"><span style="color: #6610f2;">[</span>{{ item.categoria }}<span style="color: #6610f2;">]</span></div>
          <div style="width: 200px;"><span style="color: #198754;">[</span>{{ item.plano }}<span style="color: #198754;">]</span></div>
          <div style="width: 160px;"><span style="color: #fd7e14;">[</span>{{ item.centro }}<span style="color: #fd7e14;">]</span></div>

          <div style="width: 120px;">{{ item.vencimento }}</div>
          <div style="width: 120px;"><strong>{{ item.valor | formatar }}</strong></div>
          <div style="width: 120px;">{{ item.valor_pago | formatar }}</div>

          <div style="width: 100px;">
            <span class="badge
              {% if item.status == 'Pago' %}bg-success
              {% elif item.status == 'Aberto' %}bg-warning text-dark
              {% elif item.status == 'Atrasado' %}bg-danger
              {% else %}bg-secondary{% endif %}">
              {{ item.status }}
            </span>
          </div>

          <!-- üõ†Ô∏è Bot√µes individuais -->
<div class="d-flex flex-row gap-2" style="width: 110px;">
  <!-- ‚úèÔ∏è Editar -->
  <button class="btn btn-outline-warning btn-sm px-2 py-1"
          type="button"
          title="Editar"
          onclick="abrirModalEditar('{{ item.codigo }}')">
    ‚úèÔ∏è
  </button>

  <!-- üí∏ Dar Baixa -->
  <button class="btn btn-outline-info btn-sm px-2 py-1"
          type="button"
          title="Dar baixa"
          onclick="abrirModalBaixar('{{ item.codigo }}')">
    üí∏
  </button>

  <!-- üóëÔ∏è Excluir -->
  <button class="btn btn-outline-danger btn-sm px-2 py-1"
          type="button"
          title="Excluir"
          onclick="confirmarExclusaoIndividual('{{ item.codigo }}')">
    üóëÔ∏è
  </button>
</div>>

        </div>
      </div>
      {% endfor %}
    </form>

    <!-- ‚úèÔ∏è MODAL ‚Äì Edi√ß√£o em Massa -->
    <div class="modal fade" id="modalEditarMassa" tabindex="-1">
      <div class="modal-dialog modal-xl">
        <div class="modal-content">
          <div class="modal-header bg-warning text-dark">
            <h5 class="modal-title">Editar Lan√ßamentos</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <form method="POST" action="/salvar-edicao-massa">
            <div class="modal-body">
              <table class="table table-sm table-bordered align-middle">
                <thead class="table-light">
                  <tr>
                    <th>C√≥digo</th>
                    <th>Fornecedor</th>
                    <th>Categoria</th>
                    <th>Plano</th>
                    <th>Centro</th>
                    <th>Valor</th>
                    <th>Status</th>
                    <th>Vencimento</th>
                  </tr>
                </thead>
                <tbody id="tabela-edicao"></tbody>
              </table>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-success">Salvar Altera√ß√µes</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- üí∏ MODAL ‚Äì Baixar em Massa -->
    <div class="modal fade" id="modalBaixarMassa" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header bg-info text-white">
            <h5 class="modal-title">Baixar Lan√ßamentos</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <form method="POST" action="/baixar-massa">
            <div class="modal-body">
              <div class="mb-3">
                <label for="dataPagamento" class="form-label">Data do Pagamento</label>
                <input type="date" class="form-control" id="dataPagamento" name="data_pagamento" required>
              </div>
              <div class="mb-3">
                <label for="valorPago" class="form-label">Valor Pago</label>
                <input type="number" step="0.01" class="form-control" id="valorPago" name="valor_pago" required>
              </div>
              <div id="lista-codigos-baixa"></div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-success">Confirmar Baixa</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function alternarTema() {
        const body = document.body;
        const btn = document.getElementById('botao-tema');
        const temaEscuro = body.classList.toggle('tema-escuro');
        if (temaEscuro) {
          btn.innerText = '‚òÄÔ∏è';
          localStorage.setItem('tema', 'escuro');
        } else {
          btn.innerText = 'üåô';
          localStorage.setItem('tema', 'claro');
        }
      }

      window.onload = () => {
        const tema = localStorage.getItem('tema');
        const body = document.body;
        const btn = document.getElementById('botao-tema');
        if (tema === 'escuro') {
          body.classList.add('tema-escuro');
          if (btn) btn.innerText = '‚òÄÔ∏è';
        }
      }

      function confirmarExclusao() {
        const selecionados = document.querySelectorAll('input[name="codigos"]:checked');
        if (selecionados.length === 0) {
          alert('Selecione ao menos um lan√ßamento para excluir.');
          return false;
        }
        return confirm(`Deseja realmente excluir ${selecionados.length} lan√ßamento(s)?`);
      }

      function abrirModalEditarMassa() {
        const selecionados = Array.from(document.querySelectorAll('input[name="codigos"]:checked'));
        if (selecionados.length === 0) {
          alert('Selecione ao menos um lan√ßamento para editar.');
          return;
        }

        const tabela = document.getElementById("tabela-edicao");
        tabela.innerHTML = "";

        selecionados.forEach(input => {
          const codigo = input.value;
          const linha = input.closest('.d-flex');
          const colunas = linha.querySelectorAll('div');
          const fornecedor = colunas[1].innerText.trim().replace('[','').replace(']','');
          const categoria = colunas[2].innerText.trim().replace('[','').replace(']','');
          const plano = colunas[3].innerText.trim().replace('[','').replace(']','');
          const centro = colunas[4].innerText.trim().replace('[','').replace(']','');
          const vencimento = colunas[5].innerText.trim();
          const valor = colunas[6].innerText.trim().replace('R$','').replaceAll('.','').replace(',','.');
          const status = colunas[8].innerText.trim();

          tabela.innerHTML += `
            <tr>
              <td><input type="hidden" name="codigos" value="${codigo}">${codigo}</td>
              <td><input type="text" class="form-control form-control-sm" name="fornecedor_${codigo}" value="${fornecedor}"></td>
              <td><input type="text" class="form-control form-control-sm" name="categoria_${codigo}" value="${categoria}"></td>
              <td><input type="text" class="form-control form-control-sm" name="plano_${codigo}" value="${plano}"></td>
              <td><input type="text" class="form-control form-control-sm" name="centro_${codigo}" value="${centro}"></td>
              <td><input type="number" step="0.01" class="form-control form-control-sm" name="valor_${codigo}" value="${valor}"></td>
              <td>
                <select class="form-select form-select-sm" name="status_${codigo}">
                  <option ${status === 'Aberto' ? 'selected' : ''}>Aberto</option>
                  <option ${status === 'Pago' ? 'selected' : ''}>Pago</option>
                  <option ${status === 'Pendente' ? 'selected' : ''}>Pendente</option>
                  <option ${status === 'Pago Parcialmente' ? 'selected' : ''}>Pago Parcialmente</option>
                </select>
              </td>
              <td><input type="date" class="form-control form-control-sm" name="vencimento_${codigo}" value="${formatarData(vencimento)}"></td>
            </tr>
          `;
        });

        const modal = new bootstrap.Modal(document.getElementById('modalEditarMassa'));
        modal.show();
      }

      function abrirModalBaixarMassa() {
        const selecionados = Array.from(document.querySelectorAll('input[name="codigos"]:checked'));
        if (selecionados.length === 0) {
          alert('Selecione ao menos um lan√ßamento para baixar.');
          return;
        }

        const listaCodigos = document.getElementById("lista-codigos-baixa");
        listaCodigos.innerHTML = "";

        selecionados.forEach(input => {
          const codigo = input.value;
          listaCodigos.innerHTML += `<input type="hidden" name="codigos" value="${codigo}">`;
        });

        const modal = new bootstrap.Modal(document.getElementById('modalBaixarMassa'));
        modal.show();
      }

      function formatarData(dataBR) {
        const partes = dataBR.split("/");
        return `${partes[2]}-${partes[1]}-${partes[0]}`;
      }
      // üîÑ Fun√ß√£o para editar UM lan√ßamento
function abrirModalEditar(codigo) {
  // Encontra a linha do lan√ßamento pelo c√≥digo
  const linha = document.querySelector(`input[value="${codigo}"]`).closest('.d-flex');
  const colunas = linha.querySelectorAll('div');

  // Pega os dados do lan√ßamento
  const fornecedor = colunas[1].innerText.trim().replace('[','').replace(']','');
  const categoria = colunas[2].innerText.trim().replace('[','').replace(']','');
  const plano = colunas[3].innerText.trim().replace('[','').replace(']','');
  const centro = colunas[4].innerText.trim().replace('[','').replace(']','');
  const vencimento = colunas[5].innerText.trim();
  const valor = colunas[6].innerText.trim().replace('R$','').replaceAll('.','').replace(',','.');
  const status = colunas[8].innerText.trim();

  // Preenche o modal de edi√ß√£o (usando o mesmo modal da edi√ß√£o em massa)
  const tabela = document.getElementById("tabela-edicao");
  tabela.innerHTML = `
    <tr>
      <td><input type="hidden" name="codigos" value="${codigo}">${codigo}</td>
      <td><input type="text" class="form-control form-control-sm" name="fornecedor_${codigo}" value="${fornecedor}"></td>
      <td><input type="text" class="form-control form-control-sm" name="categoria_${codigo}" value="${categoria}"></td>
      <td><input type="text" class="form-control form-control-sm" name="plano_${codigo}" value="${plano}"></td>
      <td><input type="text" class="form-control form-control-sm" name="centro_${codigo}" value="${centro}"></td>
      <td><input type="number" step="0.01" class="form-control form-control-sm" name="valor_${codigo}" value="${valor}"></td>
      <td>
        <select class="form-select form-select-sm" name="status_${codigo}">
          <option ${status === 'Aberto' ? 'selected' : ''}>Aberto</option>
          <option ${status === 'Pago' ? 'selected' : ''}>Pago</option>
          <option ${status === 'Pendente' ? 'selected' : ''}>Pendente</option>
          <option ${status === 'Pago Parcialmente' ? 'selected' : ''}>Pago Parcialmente</option>
        </select>
      </td>
      <td><input type="date" class="form-control form-control-sm" name="vencimento_${codigo}" value="${formatarData(vencimento)}"></td>
    </tr>
  `;

  // Abre o modal
  const modal = new bootstrap.Modal(document.getElementById('modalEditarMassa'));
  modal.show();
}

// üí∞ Fun√ß√£o para dar baixa em UM lan√ßamento
function abrirModalBaixar(codigo) {
  // Preenche o modal de baixa (usando o mesmo modal da baixa em massa)
  const listaCodigos = document.getElementById("lista-codigos-baixa");
  listaCodigos.innerHTML = `<input type="hidden" name="codigos" value="${codigo}">`;

  // Abre o modal
  const modal = new bootstrap.Modal(document.getElementById('modalBaixarMassa'));
  modal.show();
}

// ‚ùå Fun√ß√£o para excluir UM lan√ßamento
function confirmarExclusaoIndividual(codigo) {
  if (confirm('Deseja realmente excluir este lan√ßamento?')) {
    // Cria um formul√°rio tempor√°rio para enviar o c√≥digo
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/excluir-massa';

    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = 'codigos';
    input.value = codigo;

    form.appendChild(input);
    document.body.appendChild(form);
    form.submit();
  }
}
      function abrirModalLancamentosHoje() {
  // Busca os lan√ßamentos do dia via AJAX
  fetch('/contas-a-pagar?status=hoje&json=1')
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('lista-lancamentos-hoje');
      tbody.innerHTML = '';

      data.lancamentos.forEach(item => {
        tbody.innerHTML += `
          <tr>
            <td>${item.fornecedor}</td>
            <td>${item.categoria}</td>
            <td>${item.valor}</td>
            <td>
              <span class="badge ${getBadgeClass(item.status)}">
                ${item.status}
              </span>
            </td>
            <td>
              <button class="btn btn-outline-warning btn-sm"
                      onclick="abrirModalEditar('${item.codigo}')">‚úèÔ∏è</button>
              <button class="btn btn-outline-info btn-sm"
                      onclick="abrirModalBaixar('${item.codigo}')">üí∏</button>
              <button class="btn btn-outline-danger btn-sm"
                      onclick="confirmarExclusaoIndividual('${item.codigo}')">üóëÔ∏è</button>
            </td>
          </tr>
        `;
      });

      const modal = new bootstrap.Modal(document.getElementById('modalLancamentosHoje'));
      modal.show();
    })
    .catch(error => {
      console.error('Erro:', error);
      alert('N√£o foi poss√≠vel carregar os lan√ßamentos do dia');
    });
}

function getBadgeClass(status) {
  switch(status) {
    case 'Pago': return 'bg-success';
    case 'Aberto': return 'bg-warning text-dark';
    case 'Atrasado': return 'bg-danger';
    default: return 'bg-secondary';
  }
}
    </script>

       <!-- Modal Lan√ßamentos do Dia -->
<div class="modal fade" id="modalLancamentosHoje" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-scrollable">
    <div class="modal-content border-primary border-2 rounded-4">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title fs-5 fw-bold">
          <i class="bi bi-calendar-day me-2"></i>
          Lan√ßamentos do Dia - Total: <span id="total-hoje" class="fw-bold"></span>
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body p-0">
        <div class="table-responsive">
          <table class="table table-sm table-hover align-middle mb-0">
            <thead class="table-light sticky-top">
              <tr class="text-uppercase small">
                <th class="ps-3" style="width: 25%">Fornecedor</th>
                <th style="width: 20%">Categoria</th>
                <th style="width: 15%">Valor</th>
                <th style="width: 15%">Status</th>
                <th style="width: 25%">A√ß√µes</th>
              </tr>
            </thead>
            <tbody id="lista-lancamentos-hoje" class="border-top-0"></tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer bg-light">
        <button type="button" class="btn btn-secondary rounded-3" data-bs-dismiss="modal">
          <i class="bi bi-x-lg me-1"></i> Fechar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Edi√ß√£o -->
<div class="modal fade" id="modalEditar" tabindex="-1" aria-hidden="true" data-bs-backdrop="static">
  <div class="modal-dialog modal-lg">
    <div class="modal-content border-warning border-2 rounded-4">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title fs-5 fw-bold">
          <i class="bi bi-pencil-square me-2"></i>
          Editar Lan√ßamento
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body" id="conteudo-edicao">
        <!-- Conte√∫do ser√° preenchido via JavaScript -->
      </div>
      <div class="modal-footer bg-light">
        <button type="button" class="btn btn-secondary rounded-3" data-bs-dismiss="modal">
          <i class="bi bi-x-lg me-1"></i> Cancelar
        </button>
        <button type="button" class="btn btn-success rounded-3" onclick="salvarEdicao()">
          <i class="bi bi-check-lg me-1"></i> Salvar
        </button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Fun√ß√£o para abrir modal de lan√ßamentos do dia
  function abrirModalLancamentosHoje() {
    fetch('/contas-a-pagar?status=hoje&json=1')
      .then(response => {
        if (!response.ok) throw new Error('Erro no servidor');
        return response.json();
      })
      .then(data => {
        const tbody = document.getElementById('lista-lancamentos-hoje');
        const totalHoje = document.getElementById('total-hoje');

        tbody.innerHTML = '';
        totalHoje.textContent = data.total.toLocaleString('pt-BR', {
          style: 'currency',
          currency: 'BRL'
        });

        if (data.lancamentos && data.lancamentos.length > 0) {
          data.lancamentos.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${item.fornecedor}</td>
              <td>${item.categoria}</td>
              <td>${item.valor}</td>
              <td><span class="badge ${getBadgeClass(item.status)}">${item.status}</span></td>
              <td>
                <button class="btn btn-outline-warning btn-sm"
                        onclick="abrirModalEditar('${item.codigo}')"
                        title="Editar">
                  ‚úèÔ∏è
                </button>
                <button class="btn btn-outline-info btn-sm"
                        onclick="abrirModalBaixar('${item.codigo}')"
                        title="Dar baixa">
                  üí∏
                </button>
                <button class="btn btn-outline-danger btn-sm"
                        onclick="confirmarExclusaoIndividual('${item.codigo}')"
                        title="Excluir">
                  üóëÔ∏è
                </button>
              </td>
            `;
            tbody.appendChild(row);
          });
        } else {
          tbody.innerHTML = `
            <tr>
              <td colspan="5" class="text-center py-4 text-muted">
                <i class="bi bi-calendar-x fs-4"></i>
                <div class="mt-2">Nenhum lan√ßamento para hoje</div>
              </td>
            </tr>
          `;
        }

        const modal = new bootstrap.Modal(document.getElementById('modalLancamentosHoje'));
        modal.show();
      })
      .catch(error => {
        console.error('Erro:', error);
        alert('Erro ao carregar lan√ßamentos do dia: ' + error.message);
      });
  }

  // Fun√ß√£o para abrir modal de edi√ß√£o
  function abrirModalEditar(codigo) {
    // Fecha o modal atual primeiro
    const modalHoje = bootstrap.Modal.getInstance(document.getElementById('modalLancamentosHoje'));
    if (modalHoje) {
      modalHoje.hide();

      // Espera o modal fechar completamente antes de abrir o novo
      document.getElementById('modalLancamentosHoje').addEventListener('hidden.bs.modal', function() {
        buscarDadosEdicao(codigo);
      }, {once: true});
    } else {
      buscarDadosEdicao(codigo);
    }
  }

  function buscarDadosEdicao(codigo) {
    fetch(`/buscar-lancamento?codigo=${codigo}`)
      .then(response => response.json())
      .then(data => {
        document.getElementById('conteudo-edicao').innerHTML = `
          <form id="formEditar">
            <input type="hidden" name="codigo" value="${data.codigo}">
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <label class="form-label">Fornecedor</label>
                <input type="text" class="form-control" name="fornecedor" value="${data.fornecedor}" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Valor</label>
                <input type="text" class="form-control" name="valor" value="${data.valor}" required>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Status</label>
              <select class="form-select" name="status" required>
                <option value="Aberto" ${data.status === 'Aberto' ? 'selected' : ''}>Aberto</option>
                <option value="Pago" ${data.status === 'Pago' ? 'selected' : ''}>Pago</option>
                <option value="Pendente" ${data.status === 'Pendente' ? 'selected' : ''}>Pendente</option>
              </select>
            </div>
          </form>
        `;

        const modalEditar = new bootstrap.Modal(document.getElementById('modalEditar'));
        modalEditar.show();
      })
      .catch(error => {
        console.error('Erro:', error);
        alert('Erro ao carregar dados para edi√ß√£o');
      });
  }

  // Fun√ß√£o auxiliar para classes de status
  function getBadgeClass(status) {
    if (!status) return 'bg-secondary';

    switch(status.toLowerCase()) {
      case 'pago': return 'bg-success';
      case 'aberto': return 'bg-warning text-dark';
      case 'pendente': return 'bg-warning text-dark';
      case 'pago parcialmente': return 'bg-info text-dark';
      case 'atrasado': return 'bg-danger';
      default: return 'bg-secondary';
    }
  }

  // Suas outras fun√ß√µes existentes (confirmarExclusaoIndividual, abrirModalBaixar, etc.)
  // ... mantenha as outras fun√ß√µes que voc√™ j√° tem ...
</script>


    <!-- Toast de Sucesso (cole ANTES do </body>) -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="toastSucesso" class="toast align-items-center text-bg-success border-0" role="alert">
    <div class="d-flex">
      <div class="toast-body">
        <i class="bi bi-check-circle-fill me-2"></i>
        <span id="toastMessage">Opera√ß√£o conclu√≠da com sucesso!</span>
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
    </div>
  </div>
</div>
    </script>
  </body>
</html>